name: Ticket Auto-Followup Cron

on:
  schedule:
    # Ejecutar cada hora a los 0 minutos
    - cron: "0 * * * *"
  workflow_dispatch: # Permite ejecución manual desde GitHub UI

jobs:
  trigger-cron:
    runs-on: ubuntu-latest
    steps:
      - name: Call Auto-Followup API
        env:
          # URL de tu aplicación en producción (Railway)
          # Ej: https://mc-support-production.up.railway.app
          APP_URL: ${{ secrets.APP_URL }}

          # El secreto que definiste en tus variables de entorno
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          if [ -z "$APP_URL" ]; then
            echo "Error: APP_URL secret is not set"
            exit 1
          fi

          if [ -z "$CRON_SECRET" ]; then
            echo "Error: CRON_SECRET secret is not set"
            exit 1
          fi

          # 1. Auto-Followup (Cliente no responde)
          echo "1. Triggering Auto-Followup..."
          curl -s "$APP_URL/api/cron/followup?secret=$CRON_SECRET"

          # 2. Collaborator Inactivity (Técnico no responde)
          echo "2. Triggering Collaborator Inactivity Check..."
          curl -s "$APP_URL/api/cron/collaborator-inactivity?secret=$CRON_SECRET"

          # 3. Automated Reports (Reportes Diarios/Semanales)
          echo "3. Triggering Automated Reports..."
          curl -s "$APP_URL/api/cron/automated-reports?secret=$CRON_SECRET"

          echo "All cron jobs triggered."
